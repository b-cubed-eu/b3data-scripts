---
title: "Add spatial resources to b3data data package"
author: "Ward Langeraert"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    toc: true
    toc_float: true
    toc_collapsed: true
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, warning=FALSE, message=FALSE}
# Load packages
library(tidyverse)     # Data wrangling and visualisation
library(frictionless)  # Create frictionless data package
library(sf)            # Spatial objects

# Data path and create directory if necessary
data_path <- here::here("data", "raw")
dir.create(data_path, showWarnings = FALSE, recursive = TRUE)

out_path <- here::here("data", "processed")
dir.create(out_path, showWarnings = FALSE, recursive = TRUE)
```

# Goal

Add spatial data resources to b3data frictionless data package.

# Methods

This report focuses on adding spatial resources (e.g. GeoJSON, raster) to the **b3data** frictionless data package.

## Source Data

Spatial data need to be saved locally in the data package directory and then added manually to the descriptor file using `append()`.
We provide the reference grids for the occurrence cubes in the data package following this naming convention:

```
resource_name = "<grid><resolution>refgrid<region>"
```

Example:  
`mgrs10_refgrid_belgium` â†’ MGRS 10 km reference grid Belgium

## Resource-level Metadata

Each dataset includes the following metadata (see: [Frictionless resource spec](https://docs.ropensci.org/frictionless/articles/data-resource.html#properties-implementation)):

- **profile**: `spatial-data-resource`
- **format**: e.g. `geojson`
- **title**: e.g. `"MGRS 10 km reference grid for Belgium"`
- **description**: concise explanation of content
- **sources**: source if applicable
- **licenses**: [CC BY-NC 4.0](https://creativecommons.org/licenses/by-nc/4.0/)

# Datasets
## MGRS 10 Km reference grid Belgium

Load the data.

```{r}
# Read reference grid
utm10_bel <- st_read(file.path(data_path, "utm10_bel.shp"))

# Visualise
ggplot() + geom_sf(data = utm10_bel)
```

Clean data and transform cell codes to MGRS.

```{r}
mgrs10_refgrid_belgium <- utm10_bel %>%
  select(utm_tag = TAG, geometry) %>%
  mutate(mgrscode = ifelse(grepl("^[A-G]", utm_tag), paste0("31U", utm_tag),
                           paste0("32U", utm_tag))) %>%
  select(mgrscode, geometry)
```


## EEA 100 km reference grid Europe

> Coming soon

# Write package
